<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Administrateur - Cyber Campus</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .stat-card h3 {
            color: #fdbb2d;
            margin-bottom: 10px;
        }

        .filters {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        select, input {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        select option {
            background: #1a2a6c;
            color: white;
        }

        .sales-table {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            background: rgba(0, 0, 0, 0.2);
            color: #fdbb2d;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 5px;
            color: white;
        }

        .delete-btn {
            background: #b21f1f;
        }

        .clear-btn {
            background: #1a2a6c;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            padding: 20px;
            border-radius: 10px;
            max-width: 400px;
            width: 90%;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .partners-management {
            margin-bottom: 30px;
        }

        .partner-actions {
            margin-bottom: 20px;
        }

        .partner-form {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .partner-form input {
            margin-bottom: 10px;
        }

        .partners-table table {
            width: 100%;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
            }
        }

        .loader-wrapper {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
        }

        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .page-loader-wrapper {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1002;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .page-loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        .loader-message {
            color: white;
            margin-top: 16px;
            font-size: 1rem;
            text-align: center;
            max-width: 80%;
        }
        .subscription-required {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .subscription-required-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
        }

        .subscription-required-content h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .subscription-required-content p {
            color: #666;
            margin-bottom: 30px;
        }

        .subscription-required-content button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 0 10px;
        }

        .subscription-required-content button:hover {
            background-color: #e6a727;
        }
    </style>
</head>
<body>
    <div class="page-loader-wrapper" id="pageLoaderWrapper">
        <div class="page-loader"></div>
        <div class="loader-message" id="pageLoaderMessage">Initialisation...</div>
    </div>
    <div class="loader-wrapper" id="loaderWrapper">
        <div class="loader"></div>
    </div>
    <div class="container">
        <div class="header">
            <h1>Dashboard Administrateur</h1>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total des ventes</h3>
                <div id="totalSales">0 FCFA</div>
            </div>
            <div class="stat-card">
                <h3>Nombre de tickets vendus</h3>
                <div id="totalTickets">0</div>
            </div>
            <div class="stat-card">
                <h3>Meilleur vendeur</h3>
                <div id="topVendor">-</div>
            </div>
        </div>

        <div class="filters">
            <select id="vendorFilter">
                <option value="all">Tous les vendeurs</option>
            </select>
            <select id="periodFilter">
                <option value="today">Aujourd'hui</option>
                <option value="week">Cette semaine</option>
                <option value="month">Ce mois</option>
                <option value="all">Toute la période</option>
            </select>
            <input type="date" id="startDate">
            <input type="date" id="endDate">
            <button class="action-btn" onclick="applyFilters()">Filtrer</button>
        </div>

        <div class="sales-table">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Vendeur</th>
                        <th>Catégorie</th>
                        <th>Utilisateur</th>
                        <th>Prix</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="salesTable"></tbody>
            </table>
        </div>

        <div class="partners-management">
            <h2>Gestion des partenaires</h2>
            <div class="partner-actions">
                <button class="action-btn" onclick="showAddPartnerForm()">Ajouter un partenaire</button>
            </div>

            <div class="partner-form" id="addPartnerForm" style="display: none;">
                <h3>Ajouter un partenaire</h3>
                <input type="text" id="newPartnerName" placeholder="Nom du partenaire">
                <input type="password" id="newPartnerPassword" placeholder="Mot de passe">
                <button class="action-btn" onclick="addPartner()">Enregistrer</button>
                <button class="action-btn clear-btn" onclick="hideAddPartnerForm()">Annuler</button>
            </div>

            <div class="partners-table">
                <table>
                    <thead>
                        <tr>
                            <th>Nom du partenaire</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="partnersTable"></tbody>
                </table>
            </div>
        </div>

        <div id="editPartnerModal" class="modal">
            <div class="modal-content">
                <h2>Modifier le partenaire</h2>
                <input type="hidden" id="editPartnerId">
                <input type="text" id="editPartnerName" placeholder="Nom du partenaire">
                <input type="password" id="editPartnerPassword" placeholder="Mot de passe">
                <div class="modal-actions">
                    <button class="action-btn" onclick="closeEditModal()">Annuler</button>
                    <button class="action-btn" onclick="updatePartner()">Enregistrer</button>
                </div>
            </div>
        </div>

        <div id="messagePartnerModal" class="modal">
            <div class="modal-content">
                <h2>Envoyer un message</h2>
                <input type="hidden" id="messagePartnerId">
                <textarea id="messageContent" placeholder="Votre message"></textarea>
                <div class="modal-actions">
                    <button class="action-btn" onclick="closeMessageModal()">Annuler</button>
                    <button class="action-btn" onclick="sendMessage()">Envoyer</button>
                </div>
            </div>
        </div>
    </div>

    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h2>Confirmation</h2>
            <p id="modalMessage"></p>
            <div class="modal-actions">
                <button class="action-btn" onclick="closeModal()">Annuler</button>
                <button class="action-btn delete-btn" id="confirmBtn">Confirmer</button>
            </div>
        </div>
    </div>
    <div id="subscriptionRequiredModal" class="subscription-required" style="display: none;">
        <div class="subscription-required-content">
            <h2>Abonnement Requis</h2>
            <p>Un abonnement actif est nécessaire pour accéder à cette fonctionnalité.</p>
            <button onclick="redirectToSubscription()">S'abonner</button>
            <button onclick="hideSubscriptionRequiredModal()">Fermer</button>
        </div>
    </div>
    <script type="module">
const _0x47a559=_0x1119;(function(_0x5b4c97,_0x52c0b7){const _0x155c1c=_0x1119,_0xffb5c7=_0x5b4c97();while(!![]){try{const _0x51504a=parseInt(_0x155c1c(0x119))/0x1+parseInt(_0x155c1c(0x128))/0x2*(parseInt(_0x155c1c(0x15d))/0x3)+parseInt(_0x155c1c(0xd1))/0x4*(parseInt(_0x155c1c(0xfd))/0x5)+parseInt(_0x155c1c(0x15e))/0x6+-parseInt(_0x155c1c(0x14c))/0x7+-parseInt(_0x155c1c(0x108))/0x8+-parseInt(_0x155c1c(0xf0))/0x9;if(_0x51504a===_0x52c0b7)break;else _0xffb5c7['push'](_0xffb5c7['shift']());}catch(_0x23b5c8){_0xffb5c7['push'](_0xffb5c7['shift']());}}}(_0x4b98,0x41cbf));import{initializeApp}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';import{getDatabase,ref,get,remove,set,push}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';const firebaseConfig={'apiKey':'AIzaSyB6AUBnK_7Vy2ABWI2JMo3ebG_Sljr8XlY','authDomain':_0x47a559(0xee),'databaseURL':_0x47a559(0xd7),'projectId':'cyber-campus-2706f','storageBucket':_0x47a559(0x113),'messagingSenderId':'719410601264','appId':_0x47a559(0xe5),'measurementId':_0x47a559(0x11d)},app=initializeApp(firebaseConfig),db=getDatabase(app),adminRef=ref(db,_0x47a559(0xdb));let allSales=[],vendors=new Set(),partners={};async function loadPartners(){const _0x1226f5=_0x47a559;try{const _0x265a51=ref(db,_0x1226f5(0xf2)),_0x57697a=await get(_0x265a51);_0x57697a[_0x1226f5(0x125)]()&&(partners=_0x57697a[_0x1226f5(0xf5)](),updatePartnersTable());}catch(_0x5a977e){console[_0x1226f5(0xfe)](_0x1226f5(0x12a),_0x5a977e);}}function updatePartnersTable(){const _0x1324dd=_0x47a559,_0xa162f=document[_0x1324dd(0xe9)]('partnersTable');_0xa162f[_0x1324dd(0xce)]='';for(const _0x4d5017 in partners){const _0x33b15a=partners[_0x4d5017],_0x168618=document[_0x1324dd(0xdd)]('tr');_0x168618['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x4d5017+_0x1324dd(0x160)+_0x4d5017+'\x27)\x22>Modifier</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22action-btn\x20delete-btn\x22\x20onclick=\x22deletePartner(\x27'+_0x4d5017+_0x1324dd(0xd6)+_0x4d5017+_0x1324dd(0x105),_0xa162f[_0x1324dd(0x143)](_0x168618);}}window[_0x47a559(0xcd)]=function(){const _0x46f56b=_0x47a559;document[_0x46f56b(0xe9)]('addPartnerForm')[_0x46f56b(0xf6)][_0x46f56b(0x13c)]=_0x46f56b(0x12d);},window[_0x47a559(0x159)]=function(){const _0x3c4967=_0x47a559;document[_0x3c4967(0xe9)](_0x3c4967(0x15c))[_0x3c4967(0x141)]='',document['getElementById'](_0x3c4967(0xef))[_0x3c4967(0x141)]='',document['getElementById'](_0x3c4967(0xd0))['style'][_0x3c4967(0x13c)]='none';},window[_0x47a559(0x13f)]=async function(){const _0x4cb9a9=_0x47a559,_0x374184=document[_0x4cb9a9(0xe9)](_0x4cb9a9(0x15c))[_0x4cb9a9(0x141)],_0x49e79f=document[_0x4cb9a9(0xe9)](_0x4cb9a9(0xef))[_0x4cb9a9(0x141)];if(_0x374184&&_0x49e79f)try{const _0x5a9f87=ref(db,_0x4cb9a9(0x12b)+_0x374184);await set(_0x5a9f87,{'password':_0x49e79f}),await loadPartners(),hideAddPartnerForm();}catch(_0x265e9a){console[_0x4cb9a9(0xfe)](_0x4cb9a9(0x117),_0x265e9a);}else alert('Veuillez\x20remplir\x20tous\x20les\x20champs.');},window[_0x47a559(0x121)]=function(_0x40d667){const _0xed823a=_0x47a559,_0x4fb1a9=document[_0xed823a(0xe9)](_0xed823a(0x109));document[_0xed823a(0xe9)](_0xed823a(0x149))[_0xed823a(0x141)]=_0x40d667,document[_0xed823a(0xe9)](_0xed823a(0xc8))[_0xed823a(0x141)]=_0x40d667,document[_0xed823a(0xe9)]('editPartnerPassword')[_0xed823a(0x141)]=partners[_0x40d667]['password'],_0x4fb1a9[_0xed823a(0xf6)][_0xed823a(0x13c)]=_0xed823a(0x124);},window[_0x47a559(0xed)]=function(){const _0x566821=_0x47a559;document[_0x566821(0xe9)](_0x566821(0x109))['style']['display']=_0x566821(0x147);},window[_0x47a559(0x14f)]=async function(){const _0x546594=_0x47a559,_0x217515=document[_0x546594(0xe9)](_0x546594(0x149))[_0x546594(0x141)],_0x2597a0=document[_0x546594(0xe9)]('editPartnerName')[_0x546594(0x141)],_0x3f3535=document['getElementById'](_0x546594(0x12c))['value'];if(_0x2597a0&&_0x3f3535)try{const _0x19c1a9=ref(db,'Vendors/'+_0x2597a0);await set(_0x19c1a9,{'password':_0x3f3535}),_0x217515!==_0x2597a0&&await remove(ref(db,_0x546594(0x12b)+_0x217515)),await loadPartners(),closeEditModal();}catch(_0x155e59){console[_0x546594(0xfe)](_0x546594(0x12f),_0x155e59);}else alert(_0x546594(0x10c));},window[_0x47a559(0x11e)]=async function(_0x5b3f5b){const _0x342b75=_0x47a559;if(confirm(_0x342b75(0x151)+_0x5b3f5b+'\x20?'))try{const _0x53ae67=ref(db,_0x342b75(0x12b)+_0x5b3f5b);await remove(_0x53ae67),await loadPartners();}catch(_0x297ae2){console['error'](_0x342b75(0x152),_0x297ae2);}},window[_0x47a559(0xff)]=function(_0x33f7a1){const _0x5b7357=_0x47a559,_0x5c1f86=document['getElementById'](_0x5b7357(0x161));document['getElementById'](_0x5b7357(0xf1))[_0x5b7357(0x141)]=_0x33f7a1,document[_0x5b7357(0xe9)](_0x5b7357(0x13e))[_0x5b7357(0x141)]='',_0x5c1f86[_0x5b7357(0xf6)][_0x5b7357(0x13c)]=_0x5b7357(0x124);},window['closeMessageModal']=function(){const _0x1a2e6d=_0x47a559;document[_0x1a2e6d(0xe9)](_0x1a2e6d(0x161))['style']['display']=_0x1a2e6d(0x147);},window[_0x47a559(0x10d)]=async function(){const _0x305713=_0x47a559,_0x1dcc9b=document[_0x305713(0xe9)](_0x305713(0xf1))[_0x305713(0x141)],_0x2aa62b=document[_0x305713(0xe9)](_0x305713(0x13e))[_0x305713(0x141)];if(_0x2aa62b)try{const _0x2109a9=ref(db,_0x305713(0x12b)+_0x1dcc9b+_0x305713(0x155));await push(_0x2109a9,{'content':_0x2aa62b,'timestamp':Date['now']()}),alert(_0x305713(0x123)),closeMessageModal();}catch(_0x1732fc){console['error'](_0x305713(0xe0),_0x1732fc);}else alert('Veuillez\x20saisir\x20un\x20message.');};async function loadSalesData(){const _0x38f7e9=_0x47a559;try{const _0x45fbad=ref(db,_0x38f7e9(0xcb)),_0xd1748f=await get(_0x45fbad);_0xd1748f[_0x38f7e9(0x125)]()&&(vendors=new Set(Object[_0x38f7e9(0xde)](_0xd1748f[_0x38f7e9(0xf5)]())),updateVendorFilter());const _0xdc0361=ref(db,'VendorsHistory'),_0x353358=await get(_0xdc0361);if(_0x353358[_0x38f7e9(0x125)]()){allSales=[];const _0x12628e=_0x353358['val']();Object[_0x38f7e9(0xdf)](_0x12628e)['forEach'](([_0x3bb0d7,_0x122059])=>{const _0x758214=_0x38f7e9;Object[_0x758214(0xdf)](_0x122059)[_0x758214(0x140)](([_0x3bdba9,_0x26fa0f])=>{const _0x22cca0=_0x758214;allSales[_0x22cca0(0xd5)]({'id':_0x3bdba9,'vendor':_0x3bb0d7,..._0x26fa0f});});}),applyFilters();}}catch(_0xd57b0a){console[_0x38f7e9(0xfe)](_0x38f7e9(0x139),_0xd57b0a);}}function updateVendorFilter(){const _0x1f21d6=_0x47a559,_0x57c2b9=document[_0x1f21d6(0xe9)](_0x1f21d6(0x15f));_0x57c2b9[_0x1f21d6(0xce)]=_0x1f21d6(0x146),vendors[_0x1f21d6(0x140)](_0x11ac10=>{const _0x102025=_0x1f21d6;_0x57c2b9[_0x102025(0xce)]+=_0x102025(0x100)+_0x11ac10+'\x22>'+_0x11ac10+_0x102025(0x10e);});}async function loadSales(){const _0x57178f=_0x47a559;try{const _0x432613=ref(db,_0x57178f(0xcb)),_0x126a8b=await get(_0x432613);if(_0x126a8b['exists']()){allSales=[];const _0x46c842=_0x126a8b['val']();Object[_0x57178f(0xdf)](_0x46c842)[_0x57178f(0x140)](([_0x57c089,_0xf0d0a6])=>{const _0x5e9ec0=_0x57178f;Object[_0x5e9ec0(0xdf)](_0xf0d0a6)['forEach'](([_0x5a983a,_0x4a0d78])=>{const _0x1340c3=_0x5e9ec0;allSales[_0x1340c3(0xd5)]({'id':_0x5a983a,'vendor':_0x57c089,..._0x4a0d78});});}),applyFilters();}}catch(_0x42852a){console[_0x57178f(0xfe)](_0x57178f(0x133),_0x42852a);}}window['applyFilters']=function(){const _0x175fce=_0x47a559,_0x1ddb74=document['getElementById'](_0x175fce(0x15f))[_0x175fce(0x141)],_0x207555=document['getElementById']('periodFilter')[_0x175fce(0x141)],_0x57da90=new Date(document[_0x175fce(0xe9)](_0x175fce(0x118))[_0x175fce(0x141)]),_0x246fd7=new Date(document[_0x175fce(0xe9)](_0x175fce(0xea))[_0x175fce(0x141)]);_0x246fd7['setHours'](0x17,0x3b,0x3b);let _0x58b142=allSales;_0x1ddb74!==_0x175fce(0xdc)&&(_0x58b142=_0x58b142[_0x175fce(0x110)](_0x4bfb0e=>_0x4bfb0e[_0x175fce(0xd3)]===_0x1ddb74));if(_0x207555!==_0x175fce(0xdc)||!isNaN(_0x57da90['getTime']())||!isNaN(_0x246fd7[_0x175fce(0x12e)]())){const _0x44e2bb=new Date(),_0x10a5ed={'today':new Date(_0x44e2bb[_0x175fce(0x114)](0x0,0x0,0x0,0x0)),'week':new Date(_0x44e2bb[_0x175fce(0xec)](_0x44e2bb[_0x175fce(0x134)]()-_0x44e2bb['getDay']())),'month':new Date(_0x44e2bb[_0x175fce(0xec)](0x1))};_0x58b142=_0x58b142['filter'](_0x286993=>{const _0x34ffca=_0x175fce,_0x1899b9=new Date(_0x286993[_0x34ffca(0x126)]);if(_0x207555!==_0x34ffca(0xdc)&&_0x10a5ed[_0x207555])return _0x1899b9>=_0x10a5ed[_0x207555];if(!isNaN(_0x57da90[_0x34ffca(0x12e)]())&&!isNaN(_0x246fd7[_0x34ffca(0x12e)]()))return _0x1899b9>=_0x57da90&&_0x1899b9<=_0x246fd7;return!![];});}updateTable(_0x58b142),updateStats(_0x58b142);};function updateTable(_0xa0332e){const _0x1b258f=_0x47a559,_0x40f9e2=document[_0x1b258f(0xe9)]('salesTable');_0x40f9e2[_0x1b258f(0xce)]=_0xa0332e['sort']((_0x1eef98,_0x275e8d)=>_0x275e8d[_0x1b258f(0x126)]-_0x1eef98[_0x1b258f(0x126)])[_0x1b258f(0x156)](_0x11a6de=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+new Date(_0x11a6de[_0x1b258f(0x126)])[_0x1b258f(0xe6)]()+_0x1b258f(0xc9)+_0x11a6de[_0x1b258f(0xd3)]+_0x1b258f(0xc9)+_0x11a6de['category']+_0x1b258f(0xc9)+_0x11a6de[_0x1b258f(0x158)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x11a6de[_0x1b258f(0x127)]+_0x1b258f(0xf9)+_0x11a6de[_0x1b258f(0xd3)]+_0x1b258f(0xc6)+_0x11a6de['id']+_0x1b258f(0x122))[_0x1b258f(0x137)]('');}function updateStats(_0x1ee3f6){const _0x33a0db=_0x47a559,_0x5d43ec=_0x1ee3f6[_0x33a0db(0xf8)]((_0x5e1ad0,_0x34a582)=>_0x5e1ad0+parseFloat(_0x34a582[_0x33a0db(0x127)]),0x0),_0x2a4025=_0x1ee3f6[_0x33a0db(0x136)],_0x533006=_0x1ee3f6[_0x33a0db(0xf8)]((_0x36bb75,_0x589e7c)=>{const _0x2a15a9=_0x33a0db;return _0x36bb75[_0x589e7c[_0x2a15a9(0xd3)]]=(_0x36bb75[_0x589e7c[_0x2a15a9(0xd3)]]||0x0)+parseFloat(_0x589e7c[_0x2a15a9(0x127)]),_0x36bb75;},{}),_0x442568=Object[_0x33a0db(0xdf)](_0x533006)[_0x33a0db(0xd4)](([,_0x129b78],[,_0x266f70])=>_0x266f70-_0x129b78)[0x0]?.[0x0]||'-';document[_0x33a0db(0xe9)]('totalSales')[_0x33a0db(0xf7)]=_0x5d43ec['toLocaleString']()+_0x33a0db(0xcf),document['getElementById'](_0x33a0db(0x102))[_0x33a0db(0xf7)]=_0x2a4025,document[_0x33a0db(0xe9)](_0x33a0db(0xc7))['textContent']=_0x442568;}window[_0x47a559(0x14d)]=function(_0xf0cc7,_0x40005e){const _0xc025d6=_0x47a559,_0x3bc9be=document[_0xc025d6(0xe9)](_0xc025d6(0x142));document[_0xc025d6(0xe9)](_0xc025d6(0xc4))[_0xc025d6(0xf7)]=_0xc025d6(0xfa);const _0x45761c=document['getElementById'](_0xc025d6(0xe4));_0x45761c[_0xc025d6(0x145)]=async()=>{const _0x565b91=_0xc025d6;try{await remove(ref(db,_0x565b91(0x15b)+_0xf0cc7+'/'+_0x40005e)),await loadSales(),closeModal();}catch(_0xb1cd90){console[_0x565b91(0xfe)]('Erreur\x20lors\x20de\x20la\x20suppression:',_0xb1cd90);}},_0x3bc9be[_0xc025d6(0xf6)][_0xc025d6(0x13c)]=_0xc025d6(0x124);},window['clearVendorHistory']=function(_0x1f07b9){const _0x24549d=_0x47a559,_0x262639=document['getElementById'](_0x24549d(0x142));document[_0x24549d(0xe9)](_0x24549d(0xc4))['textContent']='Êtes-vous\x20sûr\x20de\x20vouloir\x20effacer\x20tout\x20l\x27historique\x20de\x20'+_0x1f07b9+'\x20?';const _0xed2dc8=document[_0x24549d(0xe9)](_0x24549d(0xe4));_0xed2dc8[_0x24549d(0x145)]=async()=>{const _0x5ae55a=_0x24549d;try{await set(ref(db,_0x5ae55a(0x15b)+_0x1f07b9),null),await loadSales(),closeModal();}catch(_0x345b38){console['error']('Erreur\x20lors\x20de\x20l\x27effacement:',_0x345b38);}},_0x262639[_0x24549d(0xf6)][_0x24549d(0x13c)]='flex';},window[_0x47a559(0x11c)]=function(){const _0x28fb22=_0x47a559;document['getElementById'](_0x28fb22(0x142))[_0x28fb22(0xf6)][_0x28fb22(0x13c)]=_0x28fb22(0x147);};function showLoader(){const _0x5efac2=_0x47a559;document[_0x5efac2(0xe9)](_0x5efac2(0x10a))['style'][_0x5efac2(0x13c)]=_0x5efac2(0x12d);}function hideLoader(){const _0x113b73=_0x47a559;document[_0x113b73(0xe9)]('loaderWrapper')[_0x113b73(0xf6)]['display']=_0x113b73(0x147);}function showPageLoader(){const _0x345138=_0x47a559;document[_0x345138(0xe9)](_0x345138(0xfc))[_0x345138(0xf6)]['display']='flex';}function hidePageLoader(){const _0x1d765b=_0x47a559;document[_0x1d765b(0xe9)](_0x1d765b(0xfc))['style'][_0x1d765b(0x13c)]=_0x1d765b(0x147);}function _0x1119(_0x10b734,_0x2c7f9b){const _0x4b98c8=_0x4b98();return _0x1119=function(_0x1119f6,_0x466150){_0x1119f6=_0x1119f6-0xc4;let _0x1cf40b=_0x4b98c8[_0x1119f6];return _0x1cf40b;},_0x1119(_0x10b734,_0x2c7f9b);}async function processConnectedTickets(){const _0x3b5f15=_0x47a559,_0x5ac2a2=document[_0x3b5f15(0xe9)](_0x3b5f15(0x14a));try{_0x5ac2a2[_0x3b5f15(0xf7)]=_0x3b5f15(0xf4);const _0x4ac486=ref(db,'TicketConnecté'),_0x484416=await get(_0x4ac486);let _0x1e06ac=_0x484416[_0x3b5f15(0xf5)]()||{};const _0x2e0eaa={};for(const _0x32bdae in _0x1e06ac){const _0x11c6f0=_0x1e06ac[_0x32bdae][_0x3b5f15(0x111)];!_0x2e0eaa[_0x11c6f0]&&(_0x2e0eaa[_0x11c6f0]=_0x1e06ac[_0x32bdae]);}_0x5ac2a2[_0x3b5f15(0xf7)]=_0x3b5f15(0x148);for(const _0x49a0fd in _0x2e0eaa){await processTicket(_0x2e0eaa[_0x49a0fd]);}_0x5ac2a2[_0x3b5f15(0xf7)]='Nettoyage\x20des\x20tickets\x20traités...';for(const _0x1b13d1 in _0x2e0eaa){const _0xe8fb6=Object[_0x3b5f15(0xde)](_0x1e06ac)[_0x3b5f15(0x157)](_0xd060db=>_0x1e06ac[_0xd060db][_0x3b5f15(0x111)]===_0x1b13d1);_0xe8fb6&&await remove(ref(db,'TicketConnecté/'+_0xe8fb6));}}catch(_0x5237e0){console['error'](_0x3b5f15(0x112),_0x5237e0),showNotification(_0x3b5f15(0xf3),_0x3b5f15(0xe8));}}async function processTicket(_0x419017){const _0x1121f0=_0x47a559,_0x3c6c44=document['getElementById'](_0x1121f0(0x14a));try{_0x3c6c44[_0x1121f0(0xf7)]=_0x1121f0(0x14e)+_0x419017['username']+_0x1121f0(0xe3);const _0x515ccc=ref(db,_0x1121f0(0xcb)),_0x2263e8=await get(_0x515ccc),_0xae509f=_0x2263e8[_0x1121f0(0xf5)]()||{};let _0x37f4ba=![];for(const _0x5442b9 in _0xae509f){const _0x3ba254=_0xae509f[_0x5442b9];for(const _0x43f0f9 in _0x3ba254){if(_0x3ba254[_0x43f0f9][_0x1121f0(0x158)]===_0x419017[_0x1121f0(0x111)]){_0x37f4ba=!![];break;}}if(_0x37f4ba)break;}if(!_0x37f4ba){_0x3c6c44[_0x1121f0(0xf7)]=_0x1121f0(0x153)+_0x419017[_0x1121f0(0x111)]+'...';const _0x40a9e3=ref(db,_0x1121f0(0xcc)),_0x2cd76b=ref(db,_0x1121f0(0x144)),_0x1f6a91=await get(_0x40a9e3),_0x328706=await get(_0x2cd76b),_0x3a111b=_0x1f6a91[_0x1121f0(0xf5)]()||{},_0xfed4a8=_0x328706[_0x1121f0(0xf5)]()||{};let _0x480719=null,_0x215d7a=null,_0x84172f=null;for(const _0x58eb7f in _0x3a111b){const _0x3ec11d=(_0x3a111b[_0x58eb7f][_0x1121f0(0x106)]||[])[_0x1121f0(0x10f)](_0x419017[_0x1121f0(0x111)]);if(_0x3ec11d>-0x1){_0x480719={'category':_0x58eb7f,'user':_0x3a111b[_0x58eb7f][_0x1121f0(0x106)][_0x3ec11d],'password':_0x3a111b[_0x58eb7f][_0x1121f0(0xd2)][_0x3ec11d],'price':_0x3a111b[_0x58eb7f][_0x1121f0(0xe7)][_0x3ec11d],'updatedData':{..._0x3a111b[_0x58eb7f],'utilisateur':_0x3a111b[_0x58eb7f]['utilisateur'][_0x1121f0(0x110)]((_0x579476,_0x10b694)=>_0x10b694!==_0x3ec11d),'motDePasse':_0x3a111b[_0x58eb7f]['motDePasse'][_0x1121f0(0x110)]((_0x425bbc,_0x4c514d)=>_0x4c514d!==_0x3ec11d),'prix':_0x3a111b[_0x58eb7f]['prix']['filter']((_0x147174,_0x25a8de)=>_0x25a8de!==_0x3ec11d)}},_0x215d7a=ref(db,_0x1121f0(0x130)+_0x58eb7f),_0x84172f=_0x1121f0(0xcc);break;}}if(!_0x480719)for(const _0x17636d in _0xfed4a8){if(_0xfed4a8[_0x17636d][_0x1121f0(0x158)]===_0x419017[_0x1121f0(0x111)]){_0x480719={'category':_0xfed4a8[_0x17636d]['category'],'user':_0xfed4a8[_0x17636d]['user'],'password':_0xfed4a8[_0x17636d][_0x1121f0(0x138)],'price':_0xfed4a8[_0x17636d]['price']},_0x215d7a=ref(db,_0x1121f0(0x107)+_0x17636d),_0x84172f=_0x1121f0(0x144);break;}}_0x480719&&(_0x3c6c44[_0x1121f0(0xf7)]=_0x1121f0(0x131)+_0x419017[_0x1121f0(0x111)]+_0x1121f0(0xe3),await sellTicketAutomatically(_0x480719,_0x215d7a,_0x84172f));}}catch(_0x1fd4f1){console[_0x1121f0(0xfe)](_0x1121f0(0xeb),_0x1fd4f1),showNotification(_0x1121f0(0xf3),_0x1121f0(0x115)+_0x419017['username']+'.');}}async function sellTicketAutomatically(_0x373130,_0x4e6ef6,_0x2eadab){const _0x365ee6=_0x47a559;try{const _0x53d112=_0x365ee6(0xe1),_0x2d437d=ref(db,'VendorsHistory/'+_0x53d112);await push(_0x2d437d,{'category':_0x373130[_0x365ee6(0x15a)],'user':_0x373130[_0x365ee6(0x158)],'password':_0x373130['password'],'price':_0x373130[_0x365ee6(0x127)],'soldAt':Date[_0x365ee6(0xc5)]()});const _0x3d3efe=ref(db,_0x365ee6(0xca));await push(_0x3d3efe,{'category':_0x373130[_0x365ee6(0x15a)],'user':_0x373130[_0x365ee6(0x158)],'password':_0x373130['password'],'price':_0x373130[_0x365ee6(0x127)],'soldAt':Date['now'](),'vendorId':_0x53d112}),_0x2eadab==='TicketsTotal'?await set(_0x4e6ef6,_0x373130[_0x365ee6(0x104)]):await remove(_0x4e6ef6),console['log'](_0x365ee6(0x154)+_0x373130[_0x365ee6(0x158)]+'\x20vendu\x20automatiquement.');}catch(_0x11bb87){console[_0x365ee6(0xfe)](_0x365ee6(0xda),_0x11bb87),showNotification(_0x365ee6(0xf3),_0x365ee6(0x101));}}function showSubscriptionRequiredModal(){const _0x24479a=_0x47a559;subscriptionRequiredModal['style'][_0x24479a(0x13c)]='flex';}function hideSubscriptionRequiredModal(){const _0x1ebe7c=_0x47a559;subscriptionRequiredModal[_0x1ebe7c(0xf6)][_0x1ebe7c(0x13c)]=_0x1ebe7c(0x147);}function _0x4b98(){const _0x11899f=['Vendors/','editPartnerPassword','block','getTime','Erreur\x20lors\x20de\x20la\x20mise\x20à\x20jour\x20du\x20partenaire:','TicketsTotal/','Vente\x20du\x20ticket\x20','redirectToSubscription','Erreur\x20lors\x20du\x20chargement\x20des\x20ventes:','getDate','Abonnement\x20actif','length','join','password','Erreur\x20lors\x20du\x20chargement\x20des\x20données:','DOMContentLoaded','href','display','createIcons','messageContent','addPartner','forEach','value','confirmModal','appendChild','TicketsTransit','onclick','<option\x20value=\x22all\x22>Tous\x20les\x20vendeurs</option>','none','Traitement\x20des\x20tickets\x20uniques...','editPartnerId','pageLoaderMessage','Erreur\x20lors\x20du\x20traitement\x20des\x20tickets\x20:','1492316XcZrKs','deleteSale','Vérification\x20du\x20ticket\x20pour\x20','updatePartner','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement','Êtes-vous\x20sûr\x20de\x20vouloir\x20supprimer\x20le\x20partenaire\x20','Erreur\x20lors\x20de\x20la\x20suppression\x20du\x20partenaire:','Traitement\x20du\x20ticket\x20','Ticket\x20','/messages','map','find','user','hideAddPartnerForm','category','VendorsHistory/','newPartnerName','90FltuRE','449280NqVHLe','vendorFilter','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22action-btn\x22\x20onclick=\x22showEditPartnerForm(\x27','messagePartnerModal','modalMessage','now','\x27,\x20\x27','topVendor','editPartnerName','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','TicketsVendus','VendorsHistory','TicketsTotal','showAddPartnerForm','innerHTML','\x20FCFA','addPartnerForm','1476zBDVku','motDePasse','vendor','sort','push','\x27)\x22>Supprimer</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22action-btn\x22\x20onclick=\x22showMessagePartnerForm(\x27','https://cyber-campus-2706f-default-rtdb.firebaseio.com','catch','active','Erreur\x20lors\x20de\x20la\x20vente\x20automatique\x20du\x20ticket\x20:','admin/subscription','all','createElement','keys','entries','Erreur\x20lors\x20de\x20l\x27envoi\x20du\x20message:','Vendeur\x20automatique','Une\x20erreur\x20est\x20survenue\x20lors\x20de\x20l\x27initialisation.','...','confirmBtn','1:719410601264:web:44fd2e3757721866303cf5','toLocaleString','prix','Une\x20erreur\x20est\x20survenue\x20lors\x20du\x20traitement\x20des\x20tickets.','getElementById','endDate','Erreur\x20lors\x20du\x20traitement\x20du\x20ticket\x20:','setDate','closeEditModal','cyber-campus-2706f.firebaseapp.com','newPartnerPassword','524781qHwnAK','messagePartnerId','Vendors','Erreur','Vérification\x20des\x20tickets\x20connectés...','val','style','textContent','reduce','\x20FCFA</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22action-btn\x20delete-btn\x22\x20onclick=\x22deleteSale(\x27','Êtes-vous\x20sûr\x20de\x20vouloir\x20supprimer\x20cette\x20vente\x20?','Abonnement\x20expiré','pageLoaderWrapper','2140juHlHG','error','showMessagePartnerForm','<option\x20value=\x22','Erreur\x20lors\x20de\x20la\x20vente\x20automatique\x20du\x20ticket.','totalTickets','addEventListener','updatedData','\x27)\x22>Message</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','utilisateur','TicketsTransit/','721256TPcbxc','editPartnerModal','loaderWrapper','Pas\x20d\x27abonnement\x20actif','Veuillez\x20remplir\x20tous\x20les\x20champs.','sendMessage','</option>','indexOf','filter','username','Erreur\x20lors\x20du\x20traitement\x20des\x20tickets\x20connectés\x20:','cyber-campus-2706f.appspot.com','setHours','Erreur\x20lors\x20du\x20traitement\x20du\x20ticket\x20','expired','Erreur\x20lors\x20de\x20l\x27ajout\x20du\x20partenaire:','startDate','295955jPBkaT','periodFilter','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement\x20:','closeModal','G-CEEFJP5LYZ','deletePartner','index.html','update','showEditPartnerForm','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Supprimer\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Message\x20envoyé\x20!','flex','exists','soldAt','price','6826kUCXeN','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement.','Erreur\x20lors\x20du\x20chargement\x20des\x20partenaires:'];_0x4b98=function(){return _0x11899f;};return _0x4b98();}function redirectToSubscription(){const _0x3c13f8=_0x47a559;window['location'][_0x3c13f8(0x13b)]=_0x3c13f8(0x11f);}async function checkSubscriptionStatus(){const _0x182231=_0x47a559,_0x353be1=document[_0x182231(0xe9)](_0x182231(0x14a));_0x353be1[_0x182231(0xf7)]='Vérification\x20de\x20l\x27abonnement...';try{const _0x158f15=await get(adminRef),_0x5abc18=_0x158f15[_0x182231(0xf5)](),_0x5206df=new Date();if(_0x5abc18&&_0x5abc18['status']===_0x182231(0xd9)){const _0x229347=new Date(_0x5abc18['endDate']);_0x229347<_0x5206df?(_0x353be1[_0x182231(0xf7)]=_0x182231(0xfb),showSubscriptionRequiredModal(),await adminRef[_0x182231(0x120)]({'status':_0x182231(0x116)})):_0x353be1['textContent']=_0x182231(0x135);}else _0x353be1[_0x182231(0xf7)]=_0x182231(0x10b),showSubscriptionRequiredModal();}catch(_0x71c663){console[_0x182231(0xfe)](_0x182231(0x11b),_0x71c663),_0x353be1[_0x182231(0xf7)]=_0x182231(0x150),showNotification(_0x182231(0xf3),_0x182231(0x129));}}window[_0x47a559(0x103)](_0x47a559(0x13a),async()=>{const _0x378ad=_0x47a559;showPageLoader(),await processConnectedTickets()['then'](async()=>checkSubscriptionStatus())['then'](async()=>{const _0x24ad7e=_0x1119;await loadSalesData(),await loadPartners(),document[_0x24ad7e(0xe9)](_0x24ad7e(0x11a))['value']='today',applyFilters(),lucide[_0x24ad7e(0x13d)](),hidePageLoader();})[_0x378ad(0xd8)](_0x495157=>{const _0x44f039=_0x378ad;console[_0x44f039(0xfe)](_0x44f039(0x14b),_0x495157),hidePageLoader(),showNotification(_0x44f039(0xf3),_0x44f039(0xe2));});}),window[_0x47a559(0x132)]=redirectToSubscription,window['hideSubscriptionRequiredModal']=redirectToSubscription;
    </script>
</body>
</html>